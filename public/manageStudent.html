<!DOCTYPE html>
<html>

<head>
    <title>Manage Student Details</title>
    <script src="./js/muthiah--SearchAddress.js"></script>
    <script src="./js/muthiah.js"></script>
    <script src="./js/muthiah--UpdateAndSearch.js"></script>
    <script src="./js/deleteStudent.js"></script>
    <script src="./js/lance-goh.js"></script>
    <link rel="stylesheet" href="./css/muthiah--UpdateStudent.css">
    <link rel="stylesheet" href="./css/muthiah--searchResult.css">
</head>

<body style="background: linear-gradient(135deg, #f0f4f8, #d9e2ec);">
    <div class="topNavigationBar" >
        <H2 class="headingNav">TP Student Management</H2>
        <div class="twoButtons">
            <a href="./manageStudent.html"><button class="buttonStyle">Manage Student Records</button></a>
            <a href="./manageCourse.html"><button class="buttonStyle">Manage Course Records</button></a>
        </div>
    </div>
    <br>
    <center>
        <h1 style="font-family: Arial, Helvetica, sans-serif;">Manage Student Details</h1>
        <p style="font-size: medium;">All student details can be managed here</p>
    </center>
    <div id="popupmodal" style="display: none;">
        <div id="popcontent">
            <div style=" display: flex; justify-content: space-between; align-items: center; margin-left: 20px;">
                <h5 class="formheader">Add New Student</h5>
                <button type="button" onclick="addclosepopup()" class="closebutton">&times;</button>
            </div>
            <hr>
            <br>
            <div style="margin-left: 20px;">
                <form>
                    <div style="font-size: 15px;">
                        <label for="matriculationNumber" style="display: inline-block;margin-bottom: .5rem;">Student
                            Matriculation Number :</label>
                        <br>
                        <input type="int" class="form-control" id="matriculationNumber"
                            placeholder="Enter matriculation number" style="width: 95%;">
                    </div>
                    <br>
                    <div style="font-size: 15px;">
                        <span><label for="name">Student Name</label></span>
                        <br>
                        <input type="text" class="form-control" id="name" placeholder="Enter student name"
                            style="width: 95%;">
                    </div>
                    <br>
                    <div style="font-size: 15px;">
                        <label for="courseID">Diploma Course :</label>
                        <br>
                        <select id="diplomaCourse" style="width: 100%;font-size: 20px;">

                        </select>
                    </div>
                    <br>
                    <div style="font-size: 15px;">
                        <label for="description">Postal Code :</label>
                        <br>
                        <input type="number" class="form-control" id="postalCode" style="width: 95%;">
                    </div>
                    <div style="font-size: 15px;">
                        <label for="description">Unit Number: :</label>
                        <br>
                        <input type="text" class="form-control" id="unitnumber" style="width: 95%;">
                    </div>
                    <div style="font-size: 15px;">
                        <label for="description">House Address :</label>
                        <br>
                        <input type="text" class="form-control" id="houseAddress" disabled style="width: 95%;">
                    </div>
                    <br>
                    <div style="font-size: 15px;">
                        <label for="phoneNumber">Phone Number :</label>
                        <br>
                        <input type="text" class="form-control" id="phoneNumber" placeholder="Enter phone number"
                            style="width: 95%;">
                    </div>
                    <br>
                    <div style="font-size: 15px;">
                        <label for="description">Email :</label>
                        <br>
                        <input type="email" class="form-control" id="email" disabled style="width: 95%;">
                    </div>
                    <br>
                    <div style="font-size: 15px;">
                        <label for="description">Year :</label>
                        <br>
                        <input type="number" class="form-control" id="year" placeholder="Enter year of study"
                            style="width: 95%;" min="1" max="3">
                    </div>
                    <br>
                    <div style="font-size: 15px;">
                        <label for="description">Class Name :</label>
                        <br>
                        <input type="text" class="form-control" id="className" placeholder="Enter class name"
                            style="width: 95%;">
                    </div>
                    <br>
                    <hr>
                    <br>
                    <div style="justify-self: right;">
                        <button type="button" class="btn-secondary" onclick="addclosepopup()">Close</button>
                        <button type="button" class="btn-primary" onclick="addStudent()">Add New Student</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="searchBarstyle" style="font-size: 22px;display: flex;">
        <div>
            <h2>Search for student: </h2>
        </div>
        <div>
            <input type="text" id="searchbar">
        </div>
        <div>
            <button onclick="updateSearchfunction()">
                <img src="images/search-icon-png-8.png" alt="Search icon" height="22px">
            </button>
        </div>
    </div>
    <div class="student-actions"
        style="display:flex; justify-content: flex-end; margin-bottom: 10px;margin-right: 80px;font-size: xx-large;">
        <button type="button" class="btn btn-primary" style="font-size: x-large;background-color: #bfa053;color: black;font-weight: bold;border: none;" onclick="addpopup()">Add New
            Student</button>
    </div>
    <div id="studenttab"></div>
</body>

<script>
    function editaddress() {
        const address = document.getElementById('newaddress');
        address.style.display = 'block';
    }
    function closepopup() {
        const pop = document.getElementById('popupdiv');
        pop.style.display = 'none';
    }
    function popup() {
        const pop = document.getElementById('popupdiv');
        pop.style.display = 'flex';
    }
    function addpopup() {
        const popup = document.getElementById('popupmodal')
        popup.style.display = 'block'
    }
    function addclosepopup() {
        const popup = document.getElementById('popupmodal')
        popup.style.display = 'none'
    }
    document.getElementById('matriculationNumber').addEventListener('input', function () {
        this.value = this.value.toUpperCase();
        const matric = this.value.trim();
        const email = document.getElementById('email')
        if (matric.length > 0) {
            email.value = `${matric}@student.tp.edu.sg`;
        } else {
            email.value = ''
        }
    })
    fetch('/courses')
        .then(response => response.json())
        .then(courses => {
            let options = '';
            courses.forEach((course) => {
                options += `<option value="${course.courseId}">${course.courseId}: ${course.courseName}</option>`
            });
            document.getElementById('diplomaCourse').innerHTML = options;
        });
    const postalcode = document.getElementById('postalCode');
    const unit = document.getElementById('unitnumber')
    const fulladdress = document.getElementById('houseAddress')
    function addaddress() {

        const postalCodeValue = postalcode.value.trim();
        if (postalCodeValue.length == 6) {
            fetch(`https://www.onemap.gov.sg/api/common/elastic/search?searchVal=${postalCodeValue}&returnGeom=Y&getAddrDetails=Y&pageNum=1`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjo5OTQ4LCJmb3JldmVyIjpmYWxzZSwiaXNzIjoiT25lTWFwIiwiaWF0IjoxNzYyNDQwODI3LCJuYmYiOjE3NjI0NDA4MjcsImV4cCI6MTc2MjcwMDAyNywianRpIjoiNDcyZWQyZmEtODg3OS00ZjczLWI5NGQtOTRiNTcxMTQ0N2M2In0.JqOcJTrQsTj1S4luZhiW9QhOVw8xWSv76PK4myTu2vPuHoeXR7aI9sPQOw2mzGVAcRjcwezumSttkWjLsYUvu16dICn0CDQZlynk8QLLKBdeWiah9bNH-twEMftaFHWEQnUeQmIdHqfXhMil_sBidfr1jh5-MWc-XeYD1cUWj7aiD1D9Kw7OQnjLeB4PUJrBdgD8TBP2MgLO_AWOJuQuZC24pPexlfcrFzB2JC_StsdZ0HO_3uu7WofVYby5Eet5WC8DXQK0ATtb20PhnWdUmVSC7G1PSfOWs5vk1tR-Uc9nsJ2v6MPK_VDQlKqdNrPjvwN9Tmxbt3fE--rkIoGMtQ'
                }
            })
                .then(response => response.json())
                .then(data => {
                    if (data.results && data.results.length > 0) {

                        fulladdress.value = unit.value
                            ? `Unit Number: #${unit.value}, Street Address: ${data.results[0].ADDRESS}`
                            : `${data.results[0].ADDRESS}`;
                    } else {
                        alert("No address found for that postal code.");
                        fulladdress.value = '';
                    }
                })
                .catch(err => console.error(err));
        }
    }
    postalcode.addEventListener('input', addaddress);
    unit.addEventListener('input', addaddress);
</script>



</html>